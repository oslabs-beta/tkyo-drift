/*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*::::-%@@#:..-:..+@@@@@@@@@%#++==+*%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%##########********#######%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+:#@@@@@@=.-=+#++:..:=+*##*=..*%%@@@@%#=:@@@@@@@@@@%**@@@@@@@@@@@%#+=-::..::-==+**######%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%#:.-@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@@@@@@@@@@@@@@@@+%@@@@@@@@@@:.-:=#@@@@@@@@@@@@@%%=%@@@@@@%*.:-*%%%%*-*+=-:.:-=+*#%%######%%%%###***+++=====--------======+++++++****####%%%%@@%%#=--:+@@@@@@@@@@@@@@@@@@@@@@@=-@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+*@@@@@@@@@@@@@@@@@@@@@%%%@@@@@@%-%%%+..=#%%#####*+=--=+**##%%%%%#*++=--::.........................................:%@%.....:...:::-=+*#%@@@@@@@@@**:@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%%@@@@@%#%#:-%####%%#**+=-:.                                                                 -%#. :.....::::::::::::::::::-*.@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@.#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%%@@%@@@%%=:%%*..                                                                              .%@:..:.....::::::::::::::::=-:@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@=-@@*@@@@@@@@@@@@@@@@@@@@@%*==-:.-#@@@@@@@@@@@@@@@@@@@@@%:#%+..            .************=:*****:.=****+-+****===*####=--+#%@@@@%#*::::...........%%:..-.   :@@@@@@@@@@@@@@@==-@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@@=--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%+.*@@@@@@@@@@@@@@@@@@=-%%..       ......:@@@@@@@@@@@@%.%@@@@=+@@@@%:.*@@@@#:.#@@@@+.%@@@@@@@@@@@@:....     --.=.#@-..::    +@@@@@@@@@@@@@+=+@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@@#-%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@#:@@@#@@@@@@@@@@@@%.*#+.:=++:.     .......:%@@@@*:...%@@@@%@@@@@-..-@@@@@=.*@@@@%.@@@@@=..@@@@@:           -=--:%%...--    .%@@@@@@@@@@@=-%@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@%.#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=@@@@-*@@@@@@@@@*-%%.:-:-=*@@%::... .+.  %@@@@#.#-.#@@@@@@@@@@@@*.-@@@@@@@@@@@=.*@@@@#..%@@@@**:          .=+=-.%@:..--.    =@@@@%%%%%@*=@@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@-+@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%@@@@@@#-:-=+*+-=##:--:=-..:==%@%=-.....#@@@@%.   :@@@@@+=#@@@@%. .-@@@@@@@%:..=@@@@@. =@@@@%. ..:.         =+=:-@%...:=..+%%#****####%-%@@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@%.%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.+#+:-+=+:.   . =---%%+-.:@@@@@.   .@@@@@#:+@@@@@:    #@@@@%.....@@@@@@@@@@@@#.               :+++.=@%=:.=:=:+@@%########%.@@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@*:%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@=-:----....:#@:##=::+++.       ...==.-@*@@@@@-... *@@@@-..%@@@@%. ..*@@@@#. ....=@@@@@@@@@+.                  -++-.*@*==..*:@@%%######%*+=@@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@*:%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@+*####*=:=*=-%*.*#=--+++.          ....+:.+@=-.  ..             ...##-.......... ....       ...........         .=-=.-@@*-+-=............=@@@@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@%.*@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@.%#####%@*::.-:*#-.=+==.                 .=..##:...          ........:##:........... .-=+++====------------:.   ......*@@=-==-.:+*#*:%%%#-:#@@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@=:#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%-:.:::...:=#:##=:-+=-.                   .....*@###########%@@#***%@###########@@#===+@%###########@@+*@%###########%@@@##############@%***-:@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@:=:.#@@@@@@@@@@@@@@@@@@@@%@@@@@@@@@@@@%#+:...+**#+ . ....:-==+++=---::::-==++**#%@+             :@@@@@-            -@@@@@#           +@@@@+           .@@%.             *@****+:.=@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@#.=++++.-#%@@@@@@@@@@@@@@@%-@@@@@@@@@@@@@@@*:%-::==***#%@@@@@@@@@@@@@@@@@@@@@@@@@@@@*    +@@@%.    *@@@@#.   %@@@.   .#@@@@@@@@:    #@@@@@@@%.   +@@@@@@@@@@@@@@=    :@@@@@@###%%*.:.:@@@@@@@@@@@@@@@@@@@        
@@@@%:. ..-+**-....=%%%@@@@@@@@%#:*@@@@@@@@@@@@@+.+-.++==-*##@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%.   +@@@@@.   .@@@@@    -@@@#.  :@@@@@@@@@*    =@@@@@@@@.   :@@@@@@#*@@@#.%@:    @@@*++-#@@@@*.:..*@@@@@@@@@@@@@@@@@@        
@@@+-#@@@@@@@@@@@@+.=:..-+++=:.=.#@@@@@@@@@@@@@@#..#@%@-=*##%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@    -@@@@@=   .@@@@@:            -#@@@@@@@%.   -@@@@@@@@-         #@@@@@@=%@-   .#%-#%%*+@@@@@+.:  -@@@@@@@@@@@@@@@@@@        
%-@@@@@@@@@@@@@@@@@+..+@=.*@@@@@.*%%@@@@%%@@%..*-=*@@#@:**%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@-   .@@@@@+    #@@@@-    -@@@-    =@@@@@@@@.   :@@@@@@@@=    +@@@@@@@@@@@%*@+    +@:.     .=@@@=.:  :@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@@@@@@@@*%@@@@@+*@@@@@#=..=*@@@.:**##*:%@@##-+*%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@*    -***+-    #@@@@+    %@@@@@.   =@@@@*++:    :++%@%%@*    *@#**=#%@@@@@@@%.   =@+..      ..:*-.:  :%@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@@@@@@@%*@@@@@@@*@@@@@@@@:-%%%:.#####+:%@@#=*++#%%%%%*%%@@@@@@@@@@@@@@@@@@@@@*            .-@@@@@%.   #@@@@@.    @@@@.          -@%#@@.   *@#**-%%*-...-@%    :@@:    ..  ....:.:  .%@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@@@@@@%@@@@@@@@@@@@@@@@@@@%.   -**###-:@@@%**=*==#%%%%%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@%%%%%@@@@@@@%%%@@@@@@@#=@@@@@@@@@@@@@@*:+@@@@@@@#++=:=++++++*@@@@@@@@*.    .=..  .:..:. .#@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@: .=-.=+%@%%-...-*#-:+++++++++++++====---:::...........................::::--------:::.::.-++++++++++++=.++++++++++++-:+++++++=.=#@@@@*+.    :.-.: ....:=*=#@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%.:=-:..=+%@%%-.-+++++:-++++++++++=:=++++++++++++-.:-:Authored By:                      ::.=+++++++++++++:-++++++++++++:-+++++-.=:=%@@@@=-     :.:.: .::.-**=*@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@=@@@@@@@@@@@@@@@@+..%@@.-=:-   =+#@@%=.-=++++=.=++++++++++:=+++++++++++++=..-:Tico, Milti, Anthony, Wing, Monique==++++++=======.-=====--:::::--=*##*-..:=@@@@%=:     .::.:  --.-**-*@@@@@@@@@@@@@@@@@        
@@@@@@@@@@*-@@@@@@@@@@@@@@@@@@@-=-:=....  =+*@@@+ .:-++++:.==++++++++=.==+++++++++++==...................::--==++*****+++======-----:::::---==+++*****######%%%#%%%%*@@@@%=.     .=:.: ..:::**-#@@@@@@@@@@@@@@@@@        
@@@@@@@@@@+:@@@@@@@@@@@@@@@@@@@@.:=.......-##@@@*...-**+++**##%%%%%%%%%%%%##**+++=======+++***###%%%%%%@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%#####***###%%%%@@@@@@@%%%%%%%%#@@@@%:....  .=... :.:-.**-#@@@@@@@@@@@@@@@@@        
@@@@@@@@@@#.+@@@@@@@@@@@@@@@@@@@.=-.-==....##@@@%**%%%%%%####*******####%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@%#%%%%%%%@@@@*..:..  .-... :..- =*=%@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@#.:%@@@@@@@@@@@@@@@@%.=.=+==.:..=%@@@@%#@@@@@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%#####***********+++============+**##%%%%%%%##%@@@@@@@@@@@@@@@@@@@%%##**+*@%%@#*++=.-::..  .:... :..-.:*-###%%%%@@@@@@@@@@@        
@@@@@@@@@@@@@*...-#@@@@@@@@@@@@#:=:+==-.:...=%@@@@%%@@@@@@@@@@@@@@@@@@@@@%%@@@@%%%%%##**+===-----:::::........... ......:::--.    .  .%@#--:::---=--::::.-=++++:%%@@@@@#:.=.:..  ..... ..::.....................:        
@@@@@@@@@@@@@@@@@@@%.+@@@@@@@@@*-=-+=-=:..    -+#%%%++********########***%@-..  ....:===:....::::........:::::::::::::::..:===-   : .=.%@%########*+..    .=++=#@@@@@@@%.-=..    .. :.  -:....:::----==+*%@@@@@@@        
@@@@@@#@@@@@@@@@@@@@+:@@@@@@@@@*:====-=:..    .%@@@#=++++.....++++***####@%-..  : ..-==-:.........................:::-------==+:.::  :+-%@%########*..     =-=#@@@@@@@@-.=::.      .:  .::.#@@@@@@@@@@@@@@@@@@@@@        
@@@@@@+%@@@@@@@@@@@@@@*:-+%@@@@%:+++==-=..    .=@@@@#-++.      +########@@*-=.  :-:-===:::::::::::.:::::::::::::::.........:-==++====.:+=@@%#######%%=. .:-.+%@@@@@@@@#.:-..       .  .::.:++++++***#####%%%%%@@@        
@@@@@@@+*@@@@@@@@@@@@@@-@@@@@@@@.=*+====-.    ..#@@@@%=:-     .%#######%@@-+::=====++=:.......................:::-------::::.-==-:--.. =#=@@@%#%%@@@@@%=:*=#@@@@@@@@@%-.-..           ::.-@@@@@@@@@@@@@@@@@@@%%%%        
@@@@@@@@%:+@@@@@@@@@@@@.@@@@@@@@*-+*+*##*-..  ..=@@@@@@*=:=*#%@@@%%##%@@@#==. ..::-===:::::::::::::::::--------::::::::::::::::::::--==-:-%@@%%##%%%@%%@@@@@@@@@@@@@%+....           :..:@@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@%::*@@@@@@@@=.@@@@@@@@:-=*#####*:.....*@@@@@@@@@%####*++*#%@@@-.-++=---::::::..............:::---==+++++++++++*++=-:::-+#%%@@@@@@@@@@@@@@@@@@@@@@@@@@@%#+-.            .:. .#@@@@@@@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@@@@-++=+++=+-.#@@@@@@%.-+=*=+====-...:*%@@@@@@@@@@@@@@@@@@@@@@@%%%##**++====--------=================+++++***##%%@@@@@@@@@@@@@@@%%%%###***++==--::::..             ... ..-***###%%@@@@@@@@@@@@@@@@@@@        
@@@@@@@@@@@@@@@#-++++=*=-=+.-%@@@@@:.-+===+-.   ..:***#%%%%%%%@@@@@@@@@@@@@@@@@@@%%%%%%%%%%%%%%##**++==--:::....                                                                                                         
@@@@@@@@@@@@@@@@@%+:--::=****=:..::-. ......       ...:::::..........................                                                                                                                           .        
@%%%####******+++++++++=============------:::::.............                                                   ...............................::::::::::::::::::::::------=====+++++++*******#######%%%%%%@@@@@@@        
@@@@@@@@@@@@@@@@@@%%%##############%%%%%%%%%%%%%%%%%%%%@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@*/
import fs from 'fs';
import path from 'path';
import { v4 } from 'uuid';
import { DriftModel } from './util/DriftModel.js';
import makeLogEntry from './util/makeLogEntry.js';
import makeErrorLogEntry from './util/makeErrorLogEntry.js';
import captureSharedScalarMetrics from './util/captureSharedScalarMetrics.js';

// * Global Variables for the utilities
//  Models to embed the I/O Data
export const MODELS = {
  semantic: 'Xenova/all-MiniLM-L12-v2', // Measures change in communication method
  concept: 'Xenova/e5-base-v2', // Measures change in communication intent
  lexical: 'Xenova/all-MiniLM-L6-v2', // Measures change in syntax
};
// Location to save data files
// TODO: This is relative to where the script runs, which will put data in weird places
export const OUTPUT_DIR = path.resolve('./data');
// Cache of pipeline output results, to speed up model loading
export const MODEL_CACHE = {};
// Cache of assembled models, exported for CLI tool
export const BASELINE_TYPES = ['rolling', 'training'];

export default async function tkyoDrift(text, ioType) {
  // Stopwatch START 🏎️
  console.time('Drift Analyzer Full Run');

  // Validate model config (we need the / and it's gotta be a string)
  for (const [type, name] of Object.entries(MODELS)) {
    if (typeof name !== 'string' || !name.includes('/')) {
      throw new Error(
        `Invalid or missing model ID for "${type}" model: "${name}"`
      );
    }
  }

  // Make model holder object, io types, and baselines (don't change these)
  const driftModels = {};

  //  ------------- << BEGIN try/catch Error Handling >> -------------
  // * Error handling is done within model method calls, which send the error to the catch block.
  try {
    // Check if directory exists
    if (!fs.existsSync(OUTPUT_DIR)) {
      fs.mkdirSync(OUTPUT_DIR, { recursive: true });
    }

    // Create subdirectories for vectors, scalars, and logs
    const subdirectories = ['vectors', 'scalars', 'logs'];
    for (const dir of subdirectories) {
      const subdirPath = path.join(OUTPUT_DIR, dir);
      if (!fs.existsSync(subdirPath)) {
        fs.mkdirSync(subdirPath, { recursive: true });
      }
    }

    //  ------------- << Construct Model Combinations >> -------------
    try {
      // * For each model, for each ioType, for each baselineType,
      // make a model and assign to driftModels object
      for (const [modelType, modelName] of Object.entries(MODELS)) {
        for (const baselineType of BASELINE_TYPES) {
          const key = `${modelType}.${ioType}.${baselineType}`;
          driftModels[key] = new DriftModel(
            modelType,
            modelName,
            ioType,
            baselineType
          );
        }
      }
    } catch (error) {
      throw new Error(
        `Error while constructing DriftModel objects: ${error.message}`
      );
    }
    //  ------------- << Initialize Model File Pathing >> -------------
    // * For each model, invoke set file path method
    // ! NOTE: If training data is not supplied, it will use the rolling file's path
    // Yes, this is intentional, check the ReadMe for why...
    for (const model of Object.values(driftModels)) {
      model.setFilePaths();
    }

    //  ------------- << Load the Xenova Models >> -------------
    // * Load all models sequentially
    // ! NOTE: Loading models sequentially is intentional, as they check the cache before attempting to load
    await Promise.all(
      Object.values(driftModels).map(async (model) => model.loadModel())
    );

    //  ------------- << Get Embeddings >> -------------
    // * Get embeddings for all inputs and outputs in parallel
    await Promise.all(
      Object.values(driftModels).map(async (model) => model.makeEmbedding(text))
    );

    //  ------------- << Get Scalar Metrics >> -------------
    // Capture shared scalar metrics once for each I/O type, for each baseline type
    captureSharedScalarMetrics(text, ioType);

    // * Calculate PSI values for scalar metric comparison
    await Promise.all(
      Object.values(driftModels).map(async (model) => {
        model.captureModelSpecificScalarMetrics(text);
      })
    );


    //  ------------- << Save Embedding Data >> -------------
    // * Save the embedding to the rolling/training files in parallel
    // ! NOTE: Write ops are done to separate files, this is safe
    await Promise.all(
      Object.values(driftModels).map(async (model) => model.saveToBin())
    );

    //  ------------- << Save Scalar Data >> -------------
    // * Save the embedding to the rolling/training files in parallel
    // Capture unique scalar metrics for each embedding model
    // ! NOTE: Write ops are done to separate files, this is safe
    await Promise.all(
      Object.values(driftModels).map(async (model) => model.saveScalarMetrics())
    );

    //  ------------- << Read Bin Files >> -------------
    // * Read up to N embeddings from binary blobs in parallel
    // ! NOTE: Read ops are non-blocking, this is safe
    // ? See Training Max Size/Rolling Max Size in ReadMe for more info
    // For each model, read from disk
    await Promise.all(
      Object.values(driftModels).map(async (model) => model.readFromBin())
    );

    //  ------------- << Get Baseline >> -------------
    // * Calculate Baseline values for each model in serial
    // For each model, calculate the baseline
    for (const model of Object.values(driftModels)) {
      model.getBaseline();
    }

    //  ------------- << Get Cosine Similarity >> -------------
    // * Calculate Cosine Similarity between input and baseline in serial
    const similarityResults = Object.fromEntries(
      Object.entries(driftModels).map(([key, model]) => [
        key,
        model.getCosineSimilarity(),
      ])
    );

    //  ------------- << Get Euclidean Distance >> -------------
    // * Calculate Euclidean Dist. between input and baseline in serial
    const distanceResults = Object.fromEntries(
      Object.entries(driftModels).map(([key, model]) => [
        key,
        model.getEuclideanDistance(),
      ])
    );

    //  ------------- << Make & Append Log Entries >> -------------
    // * Push the results to each log
    // Make shared ID and date for I/O Pair
    const sharedID = v4();
    makeLogEntry(sharedID, similarityResults, 'COS');
    makeLogEntry(sharedID, distanceResults, 'EUC');

    //  ------------- << END try/catch Error Handling >> -------------
    // * Push any errors to the error log
    // ! NOTE: This platform intentionally fails silently
  } catch (error) {
    makeErrorLogEntry(error);
  }

  // Stopwatch END 🏁 (Comment this out in production)
  console.timeEnd('Drift Analyzer Full Run');
}

// TODO: Remove hardcoded input/output values

// const input =
//   'Describe how the context surrounding the shape of a vector determines how much drift might occur when analyzed using cosine similarity.';
// const output = 'I am sorry, but I do know know how to respond to this request.';
// tkyoDrift(input, output);

// Shit from the actual database, should give no drift
// await tkyoDrift("forestry", "domain");
// await tkyoDrift("Comprehensive data on sustainable forest management, timber production, wildlife habitat, and carbon sequestration in forestry.", "domain_description");
// await tkyoDrift("single join", "sql_complexity");
// await tkyoDrift("only one join (specify inner, outer, cross)", "sql_complexity_description");
// await tkyoDrift("analytics and reporting", "sql_task_type");
// await tkyoDrift("generating reports, dashboards, and analytical insights", "sql_task_type_description");
// await tkyoDrift("What is the total volume of timber sold by each salesperson, sorted by salesperson?", "sql_prompt");
// await tkyoDrift("CREATE TABLE salesperson (salesperson_id INT, name TEXT, region TEXT); INSERT INTO salesperson (salesperson_id, name, region) VALUES (1, 'John Doe', 'North'), (2, 'Jane Smith', 'South'); CREATE TABLE timber_sales (sales_id INT, salesperson_id INT, volume REAL, sale_date DATE); INSERT INTO timber_sales (sales_id, salesperson_id, volume, sale_date) VALUES (1, 1, 120, '2021-01-01'), (2, 1, 150, '2021-02-01'), (3, 2, 180, '2021-01-01');", "sql_context");
// await tkyoDrift("SELECT salesperson_id, name, SUM(volume) as total_volume FROM timber_sales JOIN salesperson ON timber_sales.salesperson_id = salesperson.salesperson_id GROUP BY salesperson_id, name ORDER BY total_volume DESC;", "sql");
// await tkyoDrift("Joins timber_sales and salesperson tables, groups sales by salesperson, calculates total volume sold by each salesperson, and orders the results by total volume in descending order.", "sql_explanation");

// await tkyoDrift("defense industry", "domain");
// await tkyoDrift("Defense contract data, military equipment maintenance, threat intelligence metrics, and veteran employment stats.", "domain_description");
// await tkyoDrift("aggregation", "sql_complexity");
// await tkyoDrift("aggregation functions (COUNT, SUM, AVG, MIN, MAX, etc.), and HAVING clause", "sql_complexity_description");
// await tkyoDrift("analytics and reporting", "sql_task_type");
// await tkyoDrift("generating reports, dashboards, and analytical insights", "sql_task_type_description");
// await tkyoDrift("List all the unique equipment types and their corresponding total maintenance frequency from the equipment_maintenance table.", "sql_prompt");
// await tkyoDrift("CREATE TABLE equipment_maintenance (equipment_type VARCHAR(255), maintenance_frequency INT);", "sql_context");
// await tkyoDrift("SELECT equipment_type, SUM(maintenance_frequency) AS total_maintenance_frequency FROM equipment_maintenance GROUP BY equipment_type;", "sql");
// await tkyoDrift("This query groups the equipment_maintenance table by equipment_type and calculates the sum of maintenance_frequency for each group, then returns the equipment_type and the corresponding total_maintenance_frequency.", "sql_explanation");

// await tkyoDrift("marine biology", "domain");
// await tkyoDrift("Comprehensive data on marine species, oceanography, conservation efforts, and climate change impacts in marine biology.", "domain_description");
// await tkyoDrift("basic SQL", "sql_complexity");
// await tkyoDrift("basic SQL with a simple select statement", "sql_complexity_description");
// await tkyoDrift("analytics and reporting", "sql_task_type");
// await tkyoDrift("generating reports, dashboards, and analytical insights", "sql_task_type_description");
// await tkyoDrift("How many marine species are found in the Southern Ocean?", "sql_prompt");
// await tkyoDrift("CREATE TABLE marine_species (name VARCHAR(50), common_name VARCHAR(50), location VARCHAR(50));", "sql_context");
// await tkyoDrift("SELECT COUNT(*) FROM marine_species WHERE location = 'Southern Ocean';", "sql");
// await tkyoDrift("This query counts the number of marine species found in the Southern Ocean by using the COUNT() function with a WHERE clause.", "sql_explanation");

// // Shit that should give SOME drift
// await tkyoDrift("forest stuff", "domain");  // lexical drift
// await tkyoDrift("a bunch of data about wood and trees and animals and carbon and stuff like that", "domain_description");  // structural + lexical drift
// await tkyoDrift("a simple join, I think", "sql_complexity");
// await tkyoDrift("there's like, just one join in here (you can use any join honestly)", "sql_complexity_description");
// await tkyoDrift("making some charts and reports", "sql_task_type");
// await tkyoDrift("you know, like dashboards and insights and whatever", "sql_task_type_description");
// await tkyoDrift("How much timber did each person sell? Show me the totals pls.", "sql_prompt");
// await tkyoDrift("CREATE TABLE people (...); INSERT INTO... (lots of timber sales);", "sql_context");
// await tkyoDrift("SELECT people.name, SUM(amount) FROM logs JOIN people ...", "sql");
// await tkyoDrift("Adds up all the logs per person and shows who's got the most.", "sql_explanation");

// await tkyoDrift("financial services", "domain");
// await tkyoDrift("Data regarding trading activity, client portfolios, and compliance metrics", "domain_description");
// await tkyoDrift("multi-join query", "sql_complexity");
// await tkyoDrift("requires INNER JOINs across three tables with filters", "sql_complexity_description");
// await tkyoDrift("risk analysis", "sql_task_type");
// await tkyoDrift("evaluating exposure to market volatility and reporting findings", "sql_task_type_description");
// await tkyoDrift("What is the average transaction value per broker, broken down by region?", "sql_prompt");
// await tkyoDrift("CREATE TABLE trades (...); CREATE TABLE brokers (...);", "sql_context");
// await tkyoDrift("SELECT region, broker_id, AVG(value) FROM trades ...", "sql");
// await tkyoDrift("Calculates the average trade per broker grouped by region.", "sql_explanation");

// await tkyoDrift("marine biology", "domain");
// await tkyoDrift("A multidisciplinary examination of aquatic ecosystems, species taxonomy, climate correlations, and preservation strategies.", "domain_description");
// await tkyoDrift("simple lookup", "sql_complexity");
// await tkyoDrift("A rudimentary query structure employing a singular WHERE clause with no explicit joins or subqueries", "sql_complexity_description");
// await tkyoDrift("informational synthesis", "sql_task_type");
// await tkyoDrift("curating summarized metrics regarding species distribution across geographies", "sql_task_type_description");
// await tkyoDrift("Enumerate all identified marine species inhabiting the Southern Ocean domain.", "sql_prompt");
// await tkyoDrift("CREATE ENTITY marine_species (...);", "sql_context");
// await tkyoDrift("EXECUTE SELECT COUNT FROM marine_species WHERE region IS 'Southern Ocean';", "sql");
// await tkyoDrift("Performs aggregation to quantify species localized in a southern hemispheric aquatic biome.", "sql_explanation");

// // Shit that should be completely orthogonal
// await tkyoDrift("astrology memes", "domain");
// await tkyoDrift("Pictures of cats dressed as zodiac signs with personality captions", "domain_description");
// await tkyoDrift("none lol", "sql_complexity");
// await tkyoDrift("we're vibing, not querying", "sql_complexity_description");
// await tkyoDrift("vibe-checking", "sql_task_type");
// await tkyoDrift("checking moon phase alignment with your energy levels", "sql_task_type_description");
// await tkyoDrift("What's the best crystal to keep my ex from texting me during Mercury retrograde?", "sql_prompt");
// await tkyoDrift("instagram.com/witchyvibescrystals", "sql_context");
// await tkyoDrift("✨🧿🔮✨🧿✨", "sql");
// await tkyoDrift("This is an energetic cleanse using memes and intuition, not SQL.", "sql_explanation");

// await tkyoDrift("literary fiction", "domain");
// await tkyoDrift("Stories exploring themes of memory, solitude, and postmodern disillusionment", "domain_description");
// await tkyoDrift("narrative arc", "sql_complexity");
// await tkyoDrift("an emotionally nuanced reflection on the fragmentation of identity", "sql_complexity_description");
// await tkyoDrift("existential framing", "sql_task_type");
// await tkyoDrift("a meditation on the passage of time and urban decay", "sql_task_type_description");
// await tkyoDrift("How does the smell of rain on pavement evoke lost childhood?", "sql_prompt");
// await tkyoDrift("The streets were wet with longing, each step a memory unspoken.", "sql_context");
// await tkyoDrift("And so he walked, not toward her, but into the echo of her absence.", "sql");
// await tkyoDrift("This passage metaphorically explores emotional distance and yearning through sensory language.", "sql_explanation");

// await tkyoDrift("bathroom graffiti", "domain");
// await tkyoDrift("Bold commentary on late-stage capitalism and nihilism found on truck stop bathroom walls", "domain_description");
// await tkyoDrift("accidental JOINs", "sql_complexity");
// await tkyoDrift("JOINing my life choices with regret", "sql_complexity_description");
// await tkyoDrift("emotional breakdown analysis", "sql_task_type");
// await tkyoDrift("attempting to UNION joy with productivity", "sql_task_type_description");
// await tkyoDrift("Why is the coffee machine always broken when I need it most?", "sql_prompt");
// await tkyoDrift("CREATE TABLE scream (volume INT); INSERT INTO scream VALUES (11);", "sql_context");
// await tkyoDrift("SELECT * FROM existential_dread WHERE caffeine IS NULL;", "sql");
// await tkyoDrift("Executes the internal monologue of a DevOps engineer during a 3am incident response.", "sql_explanation");
